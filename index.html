<head>
    <meta charset="utf-8" />
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
</head>



<body>
    <div id="general_viz" class="row">
        <div id="genres" class="col bg-light overflow-auto rounded m-1"> 
        </div>
        <div id="artists" class="col bg-light rounded m-1"> 
            
        </div>
        <div id="songs" class="col bg-light overflow-auto rounded m-1 "> 
            
        </div>
   </div>
</body>

<script>
    function getGenresDistr(data,seuil) {
        var dicoGenres = {}
        for(var i = 0; i<data.length; i++){
            var genre =  data[i].genres 
            for(var t = 0 ; t<genre.length; t++){
                if(genre[t] in dicoGenres) {
                    dicoGenres[genre[t]] = dicoGenres[genre[t]] + 1;
                }
                else {
                    dicoGenres[genre[t]] = 1;
                }
            }
        }
        var valuesArray = Object.values(dicoGenres);
        valuesArray.sort((a, b) => b - a);
        var val_seuil = valuesArray[Math.floor(valuesArray.length * seuil)];
        var filteredDicoGenre = Object.fromEntries(
            Object.entries(dicoGenres).filter(([key, value]) => value >= val_seuil)
        );
        return filteredDicoGenre;
    }


    d3.json("datasets/tracks/albums_elliot.json").then(function (albums_elliot) {
        filteredData = getGenresDistr(albums_elliot,0.1);
        const w = Object.keys(filteredData).length*3;
        const h = 250;

        const yScale = d3.scaleSqrt()
                .domain([1, d3.max(Object.entries(filteredData), d => +d[1])])
                .range([0, h]);

        const barWidth = 2
        const barSpacing = 1
        const svg = d3.select("#genres")
                  .append("svg")
                  .attr("width", w)
                  .attr("height", h);
        const bars = svg.selectAll("rect")
                .data(Object.entries(filteredData))
                .enter()
                .append("g");
        bars.append("rect")
                .attr("x", (d, i) => i * (barWidth + barSpacing))
                .attr("y", (d, i) => (h -  yScale(d[1]))/2)
                .attr("width", barWidth)
                .attr("height", (d, i) => (yScale(d[1])))
                .attr("fill", (d, i) => i % 2 === 0 ? "#1DB954" : "#000000")  // Hexadecimal values for navy and steelblue
                .attr("class", "bar");

        
        
        
     })
</script>
